const dataSmall = [
  {
    id: 1,
    name: "img1",
    img: "../pic/T-Shirts (8).jpg",
    class: "img1",
    categoies: "Khmer New Year Sale!",
    usPrice: "$8.99",
    usPriceoff: "$14.95",
    Priceoff: "-40%",
    typeOfShirt: "Oversied T-Shirt",
    MaxQuantity: 50,
  },
  {
    name: "img1",
    img: "../pic/T-Shirts (7).jpg",
    class: "img1",
    categoies: "Khmer New Year Sale!",
  },
  {
    name: "img1",
    img: "../pic/T-Shirts (6).jpg",
    class: "img1",
    categoies: "Khmer New Year Sale!",
  },
  {
    name: "img1",
    img: "../pic/T-Shirts (9).jpg",
    class: "img1",
    categoies: "Khmer New Year Sale!",
  },
  {
    name: "img1",
    img: "../pic/T-Shirts (10).jpg",
    class: "img1",
    categoies: "Khmer New Year Sale!",
  },
  {
    id: 2,
    name: "img2",
    img: "../pic/h175 (2).png",
    class: "img2",
    // categoies: "Khmer New Year Sale!",
  },
  {
    id: 3,
    name: "img3",
    img: "../pic/h175 (9).png",
    class: "img3",
    // categoies: "Khmer New Year Sale!",
  },
  {
    id: 4,
    name: "img4",
    img: "../pic/h175 (4).png",
    class: "img4",
    // categoies: "Khmer New Year Sale!",
  },
  {
    id: 5,
    name: "img1",
    img: "../pic/h175 (5).png",
    class: "img5",
    // categoies: "Khmer New Year Sale!",
  },
  {
    id: 6,
    name: "img2",
    img: "../pic/h175 (6).png",
    class: "img6",
    // categoies: "Khmer New Year Sale!",
  },
  {
    id: 7,
    name: "img3",
    img: "../pic/h175 (7).png",
    class: "img7",
    // categoies: "Khmer New Year Sale!",
  },
  {
    id: 8,
    name: "img4",
    img: "../pic/h175 (1).png",
    class: "img8",
    // categoies: "Khmer New Year Sale!",
  },
  {
    id: 9,
    name: "img1",
    img: "../pic/h175 (1).png",
    link: "./login.html",
    categoies: "Khmer New Year Sale2",
  },
  {
    id: 10,
    name: "img2",
    img: "../pic/1731034178744.webp",
    categoies: "Khmer New Year Sale2",
  },
  {
    id: 11,
    name: "img3",
    img: "../pic/1743463843176.jpg",
    categoies: "Khmer New Year Sale2",
  },
  {
    id: 12,
    name: "img4",
    img: "../pic/20240918040216.webp",
    categoies: "Khmer New Year Sale2",
  },
  {
    id: 13,
    name: "img1",
    img: "../pic/h175 (1).png",
    categoies: "Khmer New Year Sale2",
  },
  {
    id: 14,
    name: "img2",
    img: "../pic/1731034178744.webp",
    categoies: "Khmer New Year Sale2",
  },
  {
    id: 15,
    name: "img3",
    img: "../pic/1743463843176.jpg",
    categoies: "Khmer New Year Sale2",
  },
  {
    id: 16,
    name: "img4",
    img: "../pic/20240918040216.webp",
    categoies: "Khmer New Year Sale2",
  },
  {
    id: 17,
    name: "img1",
    img: "../pic/1730511714186.webp",
    link: "./login.html",
    categoies: "Khmer New Year Sale3",
  },
  {
    id: 18,
    name: "img2",
    img: "../pic/1731034178744.webp",
    categoies: "Khmer New Year Sale3",
  },
  {
    id: 19,
    name: "img3",
    img: "../pic/1743463843176.jpg",
    categoies: "Khmer New Year Sale3",
  },
  {
    id: 20,
    name: "img4",
    img: "../pic/20240918040216.webp",
    categoies: "Khmer New Year Sale3",
  },
  {
    id: 21,
    name: "img1",
    img: "../pic/1730511714186.webp",
    categoies: "Khmer New Year Sale3",
  },
  {
    id: 22,
    name: "img2",
    img: "../pic/1731034178744.webp",
    categoies: "Khmer New Year Sale3",
  },
  {
    id: 23,
    name: "img3",
    img: "../pic/1743463843176.jpg",
    categoies: "Khmer New Year Sale3",
  },
  {
    id: 24,
    name: "img4",
    img: "../pic/20240918040216.webp",
    categoies: "Khmer New Year Sale3",
  },
  // Recent Product
  {
    id: 25,
    name: "ASUS Zenbook 14X OLED (UX5401)",
    price: "223$",
    img: "../pic/20240918040216.webp",
    i: "fa fa-star text-primary mr-1",
    iHalf: "fa fa-star-half-alt text-primary mr-1",
    del: "$235.00",
  },
  {
    id: 26,
    name: "ASUS Zenbook 14X OLED (UX5401)",
    price: "123$",
    img: "../pic/20240918040216.webp",
    i: "fa fa-star text-primary mr-1",
    iHalf: "fa fa-star-half-alt text-primary mr-1",
    del: "$125.00",
  },
  {
    id: 27,
    name: "ASUS Zenbook 14X OLED (UX5401)",
    price: "300$",
    img: "../pic/20240918040216.webp",
    i: "fa fa-star text-primary mr-1",
    iHalf: "fa fa-star-half-alt text-primary mr-1",
    del: "$335.00",
  },
  {
    id: 28,
    name: "ASUS Zenbook 14X OLED (UX5401)",
    price: "$234",
    img: "../pic/20240918040216.webp",
    i: "fa fa-star text-primary mr-1",
    iHalf: "fa fa-star-half-alt text-primary mr-1",
    del: "$255.00",
  },
  {
    id: 29,
    name: "ASUS Zenbook 14X OLED (UX5401)",
    price: "$234",
    img: "../pic/20240918040216.webp",
    i: "fa fa-star text-primary mr-1",
    iHalf: "fa fa-star-half-alt text-primary mr-1",
    del: "$255.00",
  },
  {
    id: 30,
    name: "ASUS Zenbook 14X OLED (UX5401)",
    price: "$234",
    img: "../pic/20240918040216.webp",
    i: "fa fa-star text-primary mr-1",
    iHalf: "fa fa-star-half-alt text-primary mr-1",
    del: "$255.00",
  },
  {
    id: 31,
    name: "ASUS Zenbook 14X OLED (UX5401)",
    price: "$234",
    img: "../pic/20240918040216.webp",
    i: "fa fa-star text-primary mr-1",
    iHalf: "fa fa-star-half-alt text-primary mr-1",
    del: "$255.00",
  },
  {
    id: 32,
    name: "ASUS Zenbook 14X OLED (UX5401)",
    price: "$234",
    img: "../pic/20240918040216.webp",
    i: "fa fa-star text-primary mr-1",
    iHalf: "fa fa-star-half-alt text-primary mr-1",
    del: "$255.00",
  },
];

let imageList = [];
let currentIndex = 0;
let currentImages = [];

const params = new URLSearchParams(window.location.search);
const id = parseInt(params.get("id"));
const product = dataSmall.find((p) => p.id === id);
// Update the main image
function updateMainImage(index) {
  const mainImage = document.getElementById("mainImage");
  const thumbnails = document.querySelectorAll(".thumbnails img");

  thumbnails.forEach((img) => img.classList.remove("active"));
  if (thumbnails[index]) thumbnails[index].classList.add("active");

  // Slide out current image
  mainImage.classList.remove("show");
  mainImage.classList.add("slide-out-left");

  setTimeout(() => {
    mainImage.src = currentImages[index];

    // Slide in new image
    mainImage.onload = () => {
      mainImage.classList.remove("slide-out-left");
      mainImage.classList.add("slide-in-right");

      setTimeout(() => {
        mainImage.classList.remove("slide-in-right");
        mainImage.classList.add("show");
      }, 50); // Small delay to trigger the transition
    };
  }, 300);
}

function selectImage(index) {
  currentIndex = index;
  updateMainImage(index);
}

function nextImage() {
  currentIndex = (currentIndex + 1) % currentImages.length;
  updateMainImage(currentIndex);
}

function prevImage() {
  currentIndex =
    (currentIndex - 1 + currentImages.length) % currentImages.length;
  updateMainImage(currentIndex);
}

window.addEventListener("DOMContentLoaded", () => {
  const thumbnailContainer = document.getElementById("thumbnailContainer");
  const mainImage = document.getElementById("mainImage");

  if (!product) {
    document.body.innerHTML = "<h2>Product not found!</h2>";
    return;
  }
  // Use "categoies" since it's what's used in your data â€” but fix in real data!
  const category = product.categoies;

  if (!category) {
    document.body.innerHTML = "<h2>This product has no category!</h2>";
    return;
  }
  // Get all images from products in the same category
  const sameCategoryItems = dataSmall.filter(
    (item) => item.categoies === category
  );
  imageList = sameCategoryItems.map((item) => item.img);

  // Remove duplicates
  imageList = [...new Set(imageList)];

  currentImages = imageList;
  currentIndex = currentImages.indexOf(product.img);
  if (currentIndex === -1) currentIndex = 0;

  mainImage.src = currentImages[currentIndex];

  // Create thumbnails
  thumbnailContainer.innerHTML = "";
  currentImages.forEach((imgSrc, index) => {
    const img = document.createElement("img");
    img.src = imgSrc;
    img.alt = `Thumbnail ${index + 1}`;
    img.classList.add("thumbnail");
    if (index === currentIndex) img.classList.add("active");

    img.addEventListener("click", () => selectImage(index));
    thumbnailContainer.appendChild(img);
  });
});

// size

const sizexs = document.querySelector(".size-Xs");
const sizes = document.querySelector(".size-S");
const sizeM = document.querySelector(".size-M");
const sizeL = document.querySelector(".size-L");

sizexs.addEventListener("click", () => {
  sizexs.classList.toggle("sizeSelected");
  sizexs.innerHTML = "XS";
  sizes.classList.remove("sizeSelected");
  sizeM.classList.remove("sizeSelected");
  sizeL.classList.remove("sizeSelected");
});
sizes.addEventListener("click", () => {
  sizes.classList.toggle("sizeSelected");
  sizes.innerHTML = "S";
  sizexs.classList.remove("sizeSelected");
  sizeM.classList.remove("sizeSelected");
  sizeL.classList.remove("sizeSelected");
});
sizeM.addEventListener("click", () => {
  sizeM.innerHTML = "M";
  sizeM.classList.toggle("sizeSelected");
  sizexs.classList.remove("sizeSelected");
  sizes.classList.remove("sizeSelected");
  sizeL.classList.remove("sizeSelected");
});
sizeL.addEventListener("click", () => {
  sizeL.classList.toggle("sizeSelected");
  sizeL.innerHTML = "L";
  sizexs.classList.remove("sizeSelected");
  sizes.classList.remove("sizeSelected");
  sizeM.classList.remove("sizeSelected");
  console.log(sizeL.textContent);
});

const increment = document.querySelector(".increment");
const decrement = document.querySelector(".decrement");
const resultQTY = document.querySelector(".resultQTY");
const btnSub = document.querySelector(".btn-sub");
const result = document.querySelector(".result");
const wrapperitems = document.querySelector(".wrapper-items");
const sizeitem = document.querySelector(".sizeitem");
const qtryitem = document.querySelector(".qtyitem");

resultQTY.innerHTML = 0;
result.innerHTML = 0;
sizeitem.innerHTML = "";
increment.addEventListener("click", function () {
  resultQTY.innerHTML = parseInt(resultQTY.innerHTML) + 1;
});
decrement.addEventListener("click", function () {
  if (resultQTY.innerHTML <= 0) {
    resultQTY.innerHTML = 0;
  } else {
    resultQTY.innerHTML = parseInt(resultQTY.innerHTML) - 1;
  }
});
const udprice = document.querySelector(".usPrice");
const offPrice = document.querySelector(".offPrice");
const usPriceoff = document.querySelector(".usPriceoff");
const typeOfShirt = document.querySelector(".typeOfShirt");
const udpricevart = document.querySelector(".usPricecart");
const offPricecart = document.querySelector(".offPricecart");
const usPriceoffcart = document.querySelector(".usPriceoffcart");
const typeOfShirtcart = document.querySelector(".typeOfShirtcart");
const totalPrice = document.querySelector(".totalPrice");
console.log(totalPrice);

if (udprice || offPrice || usPriceoff) {
  usPriceoff.textContent = product.usPriceoff;
  udprice.textContent = product.usPrice;
  offPrice.textContent = product.Priceoff;
  typeOfShirt.textContent = product.typeOfShirt;
}

let totalQuantity = 0; // Keep track of all items added
btnSub.addEventListener("click", function () {
  const quantity = parseInt(resultQTY.innerHTML);
  const selectedSize = document.querySelector(".sizeSelected");

  if (!selectedSize) {
    alert("Please select a size before adding to cart.");
    return;
  }

  if (quantity <= 0) {
    alert("Please choose a quantity greater than 0.");
    return;
  }

  // âœ… Update total result
  totalQuantity += quantity;
  result.innerHTML = totalQuantity;
  qtryitem.innerHTML = "Quantity: " + totalQuantity;
  sizeitem.innerHTML += `Your Ordered: [${selectedSize.textContent}: ${quantity}] `;

  // âœ… Get selected image
  const selectedImageSrc = document.getElementById("mainImage").src;

  // âœ… Show preview
  let previewImg = document.querySelector(".cart-preview-img");
  if (!previewImg) {
    previewImg = document.createElement("img");
    previewImg.classList.add("cart-preview-img");
    document.body.appendChild(previewImg);
  }
  previewImg.src = selectedImageSrc;

  // âœ… Add to cart
  const cartItem = {
    id: product.id,
    name: product.name,
    size: selectedSize.textContent,
    quantity: quantity,
    image: selectedImageSrc,
    usPriceoff: product.usPriceoff,
    udprice: product.price,
    offPrice: product.Priceoff,
    typeOfShirt: product.typeOfShirt,
  };

  let cart = JSON.parse(localStorage.getItem("cart")) || [];

  // âœ… Check if same size already in cart â€” if so, update quantity
  const existingItem = cart.find(
    (item) => item.id === product.id && item.size === cartItem.size
  );

  if (existingItem) {
    existingItem.quantity += quantity;
  } else {
    cart.push(cartItem);
  }

  localStorage.setItem("cart", JSON.stringify(cart));

  // âœ… Calculate total price for this added item
  const cleanPrice = parseFloat(product.usPrice.replace("$", ""));
  const itemTotalPrice = cleanPrice * totalQuantity;

  console.log("Cart item added:", cartItem);
  alert(
    `Added to cart: ${cartItem.name} [Size: ${cartItem.size}, Qty: ${cartItem.quantity}]\n` +
      `Price per item: ${product.usPrice}\n` +
      `Total for this item: $${itemTotalPrice.toFixed(2)}`
  );
  totalPrice.textContent = "Total US $" + itemTotalPrice;

  // âœ… Reset input
  resultQTY.innerHTML = 0;
  selectedSize.classList.remove("sizeSelected");
  // âœ… Display product details

  if (udpricevart || offPricecart || usPriceoffcart) {
    udpricevart.textContent = product.usPrice;
    offPricecart.textContent = product.Priceoff;
    usPriceoffcart.textContent = product.usPriceoff;
    typeOfShirtcart.textContent = product.typeOfShirt;
  }
  const btnclear = document.querySelector(".btn-clear");
  btnclear.innerHTML = "ClearForm";
  btnclear.classList.add("active");
  btnclear.addEventListener("click", function () {
    localStorage.removeItem("cart"); // Clear all cart data

    // Optional: reset UI elements
    totalQuantity = 0;
    result.innerHTML = 0;
    qtryitem.innerHTML = 0;
    sizeitem.innerHTML = "";
    usPriceoffcart.innerHTML = "";
    offPricecart.innerHTML = "";
    usPriceoffcart.innerHTML = "";
    udpricevart.innerHTML = "";
    totalPrice.innerHTML = "";
    typeOfShirtcart.innerHTML = "No Information";

    const previewImg = document.querySelector(".cart-preview-img");
    if (previewImg) {
      previewImg.src = "";
    }
    alert("Cart has been cleared.");
  });
});
// remove

// add to cart

// dropdown info
const headers = document.querySelectorAll(".dropdown-header");
headers.forEach((header) => {
  header.addEventListener("click", () => {
    const content = header.querySelector(".wrapper-infoText"); // Get the next .dropdown-content
    const chevron = header.querySelector(".chevron");

    // Toggle active class for content
    content.classList.toggle("active");

    // Toggle icon class
    if (content.classList.contains("active")) {
      chevron.classList.remove("fa-chevron-down");
      chevron.classList.add("fa-chevron-up");
    } else {
      chevron.classList.remove("fa-chevron-up");
      chevron.classList.add("fa-chevron-down");
    }
  });
});
