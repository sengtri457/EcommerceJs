// import dataSmall from "./data";
// const dataSmall2 = [...dataSmall];
// console.log(dataSmall2);
const dataSmall2 = [
  {
    id: 24,
    subId: 40,
    name: "Crop Jacket",
    img: "../pic/submenn8.avif",
    class: "img1",
    categoies: "Khmer New Year Sale6",
    usPrice: "$30.99",
    usPriceoff: "$40.95",
    Priceoff: "-40%",
    typeOfShirt: "Oversied CropTop",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    id: 25,
    // subId: 13,
    name: "img1",
    img: "../pic/submenn8-1.avif",
    class: "img1",
    categoies: "Khmer New Year Sale6",
    usPrice: "$30.99",
    usPriceoff: "$40.95",
    Priceoff: "-40%",
    typeOfShirt: "Oversied CropTop",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    id: 26,
    // subId: 13,
    name: "img1",
    img: "../pic/submen8-2.avif",
    class: "img1",
    categoies: "Khmer New Year Sale6",
    usPrice: "$30.99",
    usPriceoff: "$40.95",
    Priceoff: "-40%",
    typeOfShirt: "Oversied CropTop",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    id: 27,
    // subId: 13,
    name: "img1",
    img: "../pic/submenn8-3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale6",
    usPrice: "$30.99",
    usPriceoff: "$40.95",
    Priceoff: "-40%",
    typeOfShirt: "Oversied CropTop",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    id: 36,
    subId: 13,
    name: "Crop Hoodiess",
    img: "../pic/submenn9.avif",
    class: "img1",
    categoies: "Khmer New Year Sale7",
    usPrice: "$30.99",
    usPriceoff: "$40.95",
    Priceoff: "-40%",
    typeOfShirt: "Oversied CropTop",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    id: 37,
    // subId: 13,
    name: "img1",
    img: "../pic/submenn9-1.avif",
    class: "img1",
    categoies: "Khmer New Year Sale7",
    usPrice: "$30.99",
    usPriceoff: "$40.95",
    Priceoff: "-40%",
    typeOfShirt: "Oversied CropTop",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    id: 38,
    // subId: 13,
    name: "img1",
    img: "../pic/submenn9-2.avif",
    class: "img1",
    categoies: "Khmer New Year Sale7",
    usPrice: "$30.99",
    usPriceoff: "$40.95",
    Priceoff: "-40%",
    typeOfShirt: "Oversied CropTop",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    id: 39,
    // subId: 13,
    name: "img1",
    img: "../pic/submen9-3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale7",
    usPrice: "$30.99",
    usPriceoff: "$40.95",
    Priceoff: "-40%",
    typeOfShirt: "Oversied CropTop",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    id: 64,
    subId: 22,
    name: "Crop Polo",
    img: "../pic/subpolomen1.avif",
    class: "img1",
    categoies: "Khmer New Year Sale13",
    usPrice: "$10.99",
    usPriceoff: "$20.95",
    Priceoff: "-40%",
    typeOfShirt: "Polo",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    id: 65,
    // subId: 40,
    name: "img1",
    img: "../pic/subpolomen2.avif",
    class: "img1",
    categoies: "Khmer New Year Sale13",
    usPrice: "$10.99",
    usPriceoff: "$20.95",
    Priceoff: "-40%",
    typeOfShirt: "Oversied T-Shirt",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    id: 66,
    // subId: 40,
    name: "img1",
    img: "../pic/subpolomen3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale13",
    usPrice: "$10.99",
    usPriceoff: "$20.95",
    Priceoff: "-40%",
    typeOfShirt: "Oversied T-Shirt",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    id: 67,
    // subId: 40,
    name: "img1",
    img: "../pic/subpolormen4.avif",
    class: "img1",
    categoies: "Khmer New Year Sale13",
    usPrice: "$10.99",
    usPriceoff: "$20.95",
    Priceoff: "-40%",
    typeOfShirt: "Oversied T-Shirt",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    id: 68,
    subId: 22,
    name: "Color Polo",
    img: "../pic/subpolomen2-3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale14",
    usPrice: "$10.99",
    usPriceoff: "$20.95",
    Priceoff: "-40%",
    typeOfShirt: "Oversied Polo",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    id: 69,
    // subId: 40,
    name: "img1",
    img: "../pic/subpolomen2-1.avif",
    class: "img1",
    categoies: "Khmer New Year Sale14",
    usPrice: "$10.99",
    usPriceoff: "$20.95",
    Priceoff: "-40%",
    typeOfShirt: "Oversied T-Shirt",
    MaxQuantity: 50,
    similar: "top",
  },

  {
    id: 70,
    // subId: 40,
    name: "img1",
    img: "../pic/subpolomen2-2.avif",
    class: "img1",
    categoies: "Khmer New Year Sale14",
    usPrice: "$10.99",
    usPriceoff: "$20.95",
    Priceoff: "-40%",
    typeOfShirt: "Oversied T-Shirt",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    id: 71,
    // subId: 40,
    name: "img1",
    img: "../pic/subpolomen2-4.avif",
    class: "img1",
    categoies: "Khmer New Year Sale14",
    usPrice: "$10.99",
    usPriceoff: "$20.95",
    Priceoff: "-40%",
    typeOfShirt: "Oversied T-Shirt",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    id: 72,
    subId: 22,
    name: "White Polo",
    img: "../pic/subpolomen3-3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale15",
    usPrice: "$10.99",
    usPriceoff: "$20.95",
    Priceoff: "-40%",
    typeOfShirt: "Oversied Polo",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    id: 92,
    name: "Nike Club",
    img: "../pic/s5.avif",
    class: "img1",
    categoies: "Khmer New Year Sale92",
    usPrice: "$60.99",
    usPriceoff: "$100.95",
    Priceoff: "-40%",
    typeOfShirt: "short",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    name: "img1",
    img: "../pic/subs-1.avif",
    class: "img1",
    categoies: "Khmer New Year Sale92",
  },
  {
    name: "img1",
    img: "../pic/subs5-2.avif",
    class: "img1",
    categoies: "Khmer New Year Sale92",
  },
  {
    name: "img1",
    img: "../pic/subbs5-3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale92",
  },
  {
    name: "img1",
    img: "../pic/subs5-4.avif",
    class: "img1",
    categoies: "Khmer New Year Sale92",
  },
  {
    id: 93,
    name: "Nike Club",
    img: "../pic/s6.avif",
    class: "img1",
    categoies: "Khmer New Year Sale93",
    usPrice: "$60.99",
    usPriceoff: "$100.95",
    Priceoff: "-40%",
    typeOfShirt: "short",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    name: "img1",
    img: "../pic/subs6-1.avif",
    class: "img1",
    categoies: "Khmer New Year Sale93",
  },
  {
    name: "img1",
    img: "../pic/subs6-2.avif",
    class: "img1",
    categoies: "Khmer New Year Sale93",
  },
  {
    name: "img1",
    img: "../pic/subs6-3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale93",
  },
  {
    name: "img1",
    img: "../pic/subs6-4.avif",
    class: "img1",
    categoies: "Khmer New Year Sale93",
  },
  {
    id: 94,
    name: "Nike 24.7 PerfectStretch",
    img: "../pic/s7.avif",
    class: "img1",
    categoies: "Khmer New Year Sale94",
    usPrice: "$95.99",
    usPriceoff: "$100.95",
    Priceoff: "-5%",
    typeOfShirt: "short",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    name: "img1",
    img: "../pic/s8.avif",
    class: "img1",
    categoies: "Khmer New Year Sale94",
  },
  {
    name: "img1",
    img: "../pic/subbs7-2.avif",
    class: "img1",
    categoies: "Khmer New Year Sale94",
  },
  {
    name: "img1",
    img: "../pic/subbs7-3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale94",
  },
  {
    name: "img1",
    img: "../pic/subs7-4.avif",
    class: "img1",
    categoies: "Khmer New Year Sale94",
  },
  {
    id: 95,
    name: "Nike 24.7 Club",
    img: "../pic/s9.avif",
    class: "img1",
    categoies: "Khmer New Year Sale95",
    usPrice: "$55.99",
    usPriceoff: "$100.95",
    Priceoff: "-45%",
    typeOfShirt: "short",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    name: "img1",
    img: "../pic/subs9-1.avif",
    class: "img1",
    categoies: "Khmer New Year Sale95",
  },
  {
    name: "img1",
    img: "../pic/subs9-2.avif",
    class: "img1",
    categoies: "Khmer New Year Sale95",
  },
  {
    name: "img1",
    img: "../pic/subs9-3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale95",
  },
  {
    name: "img1",
    img: "../pic/subs9-4.avif",
    class: "img1",
    categoies: "Khmer New Year Sale95",
  },
  {
    id: 96,
    name: "Nike 24.7 Club",
    img: "../pic/s10.avif",
    class: "img1",
    categoies: "Khmer New Year Sale96",
    usPrice: "$95.99",
    usPriceoff: "$100.95",
    Priceoff: "-5%",
    typeOfShirt: "short",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    name: "img1",
    img: "../pic/subs10-1.avif",
    class: "img1",
    categoies: "Khmer New Year Sale96",
  },
  {
    name: "img1",
    img: "../pic/subs10-2.avif",
    class: "img1",
    categoies: "Khmer New Year Sale96",
  },
  {
    name: "img1",
    img: "../pic/subs10-3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale96",
  },
  {
    name: "img1",
    img: "../pic/subs10-4.avif",
    class: "img1",
    categoies: "Khmer New Year Sale96",
  },

  {
    id: 97,
    name: "Nike Life",
    img: "../pic/s11.avif",
    class: "img1",
    categoies: "Khmer New Year Sale97",
    usPrice: "$85.99",
    usPriceoff: "$100.95",
    Priceoff: "-15%",
    typeOfShirt: "short",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    name: "img1",
    img: "../pic/subs11-1.avif",
    class: "img1",
    categoies: "Khmer New Year Sale97",
  },
  {
    name: "img1",
    img: "../pic/subbs11-2.avif",
    class: "img1",
    categoies: "Khmer New Year Sale97",
  },
  {
    name: "img1",
    img: "../pic/subbs11-3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale97",
  },
  {
    name: "img1",
    img: "../pic/subs11-4.avif",
    class: "img1",
    categoies: "Khmer New Year Sale97",
  },
  {
    id: 119,
    name: "Nike Pro",
    img: "../../pic/len1.avif",
    class: "img1",
    categoies: "Khmer New Year Sale119",
    usPrice: "$40.99",
    usPriceoff: "$50.95",
    Priceoff: "-10%",
    typeOfShirt: "1/2 Length",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    name: "img1",
    img: "../pic/sublen1-1.avif",
    class: "img1",
    categoies: "Khmer New Year Sale119",
  },
  {
    name: "img1",
    img: "../pic/sublen1-2.avif",
    class: "img1",
    categoies: "Khmer New Year Sale119",
  },
  {
    name: "img1",
    img: "../pic/sublen1-3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale119",
  },
  {
    name: "img1",
    img: "../pic/sublen1-4.avif",
    class: "img1",
    categoies: "Khmer New Year Sale119",
  },
  {
    id: 120,
    subId: 119,
    name: "Nike life",
    img: "../../pic/len2.avif",
    class: "img1",
    categoies: "Khmer New Year Sale120",
    usPrice: "$20.99",
    usPriceoff: "$40.95",
    Priceoff: "-50%",
    typeOfShirt: "1/2 Length",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    name: "img1",
    img: "../pic/subllen2-1.avif",
    class: "img1",
    categoies: "Khmer New Year Sale120",
  },
  {
    name: "img1",
    img: "../pic/sublen2-2.avif",
    class: "img1",
    categoies: "Khmer New Year Sale120",
  },
  {
    name: "img1",
    img: "../pic/sublen2-3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale120",
  },
  {
    name: "img1",
    img: "../pic/sublen2-4.avif",
    class: "img1",
    categoies: "Khmer New Year Sale120",
  },
  {
    id: 121,
    subId: 120,
    name: "Nike Primary",
    img: "../../pic/len3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale121",
    usPrice: "$10.99",
    usPriceoff: "$50.95",
    Priceoff: "-90%",
    typeOfShirt: "1/2 Length",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    name: "img1",
    img: "../pic/sublen3-1.avif",
    class: "img1",
    categoies: "Khmer New Year Sale121",
  },
  {
    name: "img1",
    img: "../pic/sublen3-2.avif",
    class: "img1",
    categoies: "Khmer New Year Sale121",
  },
  {
    name: "img1",
    img: "../pic/sublen3-3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale121",
  },
  {
    name: "img1",
    img: "../pic/sublen3-4.avif",
    class: "img1",
    categoies: "Khmer New Year Sale121",
  },
  {
    id: 122,
    subId: 120,
    name: "Nike Pro",
    img: "../../pic/len3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale122",
    usPrice: "$20.99",
    usPriceoff: "$40.95",
    Priceoff: "-50%",
    typeOfShirt: "1/2 Length",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    name: "img1",
    img: "../pic/sublen3-1.avif",
    class: "img1",
    categoies: "Khmer New Year Sale122",
  },
  {
    name: "img1",
    img: "../pic/sublen3-2.avif",
    class: "img1",
    categoies: "Khmer New Year Sale122",
  },
  {
    name: "img1",
    img: "../pic/sublen3-3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale122",
  },
  {
    name: "img1",
    img: "../pic/sublen3-4.avif",
    class: "img1",
    categoies: "Khmer New Year Sale122",
  },
  {
    id: 123,
    subId: 120,
    name: "Nike Lava",
    img: "../../pic/len2.avif",
    class: "img1",
    categoies: "Khmer New Year Sale123",
    usPrice: "$30.99",
    usPriceoff: "$50.95",
    Priceoff: "-20%",
    typeOfShirt: "1/2 Length",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    name: "img1",
    img: "../pic/subllen2-1.avif",
    class: "img1",
    categoies: "Khmer New Year Sale123",
  },
  {
    name: "img1",
    img: "../pic/sublen2-2.avif",
    class: "img1",
    categoies: "Khmer New Year Sale123",
  },
  {
    name: "img1",
    img: "../pic/sublen2-3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale123",
  },
  {
    name: "img1",
    img: "../pic/sublen2-4.avif",
    class: "img1",
    categoies: "Khmer New Year Sale123",
  },
  {
    id: 124,
    subId: 120,
    name: "Nike Life",
    img: "../../pic/len1.avif",
    class: "img1",
    categoies: "Khmer New Year Sale124",
    usPrice: "$40.99",
    usPriceoff: "$50.95",
    Priceoff: "-10%",
    typeOfShirt: "1/2 Length",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    name: "img1",
    img: "../pic/sublen1-1.avif",
    class: "img1",
    categoies: "Khmer New Year Sale124",
  },
  {
    name: "img1",
    img: "../pic/sublen1-2.avif",
    class: "img1",
    categoies: "Khmer New Year Sale124",
  },
  {
    name: "img1",
    img: "../pic/sublen1-3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale124",
  },
  {
    name: "img1",
    img: "../pic/sublen1-4.avif",
    class: "img1",
    categoies: "Khmer New Year Sale124",
  },
  // mid
  {
    id: 125,
    subId: 127,
    name: "Nike Project",
    img: "../../pic/mid1.avif",
    class: "img1",
    categoies: "Khmer New Year Sale125",
    usPrice: "$80.99",
    usPriceoff: "$100.95",
    Priceoff: "-20%",
    typeOfShirt: "Mid-Thigh",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    name: "img1",
    img: "../pic/submid1-1.avif",
    class: "img1",
    categoies: "Khmer New Year Sale125",
  },
  ,
  {
    name: "img1",
    img: "../pic/submid1-2.avif",
    class: "img1",
    categoies: "Khmer New Year Sale125",
  },
  ,
  {
    name: "img1",
    img: "../pic/submid1-3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale125",
  },
  ,
  {
    name: "img1",
    img: "../pic/submid1-4.avif",
    class: "img1",
    categoies: "Khmer New Year Sale125",
  },
  {
    name: "img1",
    img: "../pic/subleg1.avif",
    class: "img1",
    categoies: "Khmer New Year Sale26",
    usPrice: "$30.99",
    usPriceoff: "$50.95",
    Priceoff: "-40%",
    typeOfShirt: "Legging",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    name: "img1",
    img: "../pic/subleg2.avif",
    class: "img1",
    categoies: "Khmer New Year Sale26",
    usPrice: "$30.99",
    usPriceoff: "$50.95",
    Priceoff: "-40%",
    typeOfShirt: "Legging",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    name: "img1",
    img: "../pic/subleg3.avif",
    class: "img1",
    categoies: "Khmer New Year Sale26",
    usPrice: "$30.99",
    usPriceoff: "$50.95",
    Priceoff: "-40%",
    typeOfShirt: "Legging",
    MaxQuantity: 50,
    similar: "top",
  },
  {
    name: "img1",
    img: "../pic/subleg4.avif",
    class: "img1",
    categoies: "Khmer New Year Sale26",
    usPrice: "$30.99",
    usPriceoff: "$50.95",
    Priceoff: "-40%",
    typeOfShirt: "Legging",
    MaxQuantity: 50,
    similar: "top",
  },
];

let imageList = [];
let currentIndex = 0;
let currentImages = [];
const params = new URLSearchParams(window.location.search);
const id = parseInt(params.get("id"));
const product = dataSmall2.find((p) => p.id === id);
// Update the main image
function updateMainImage(index) {
  const mainImage = document.getElementById("mainImage");
  const thumbnails = document.querySelectorAll(".thumbnails img");

  thumbnails.forEach((img) => img.classList.remove("active"));
  if (thumbnails[index]) thumbnails[index].classList.add("active");
  // Slide out current image
  mainImage.classList.remove("show");
  mainImage.classList.add("slide-out-left");

  setTimeout(() => {
    mainImage.src = currentImages[index];

    // Slide in new image
    mainImage.onload = () => {
      mainImage.classList.remove("slide-out-left");
      mainImage.classList.add("slide-in-right");

      setTimeout(() => {
        mainImage.classList.remove("slide-in-right");
        mainImage.classList.add("show");
      }, 50); // Small delay to trigger the transition
    };
  }, 300);
}
function selectImage(index) {
  currentIndex = index;
  updateMainImage(index);
}
function nextImage() {
  currentIndex = (currentIndex + 1) % currentImages.length;
  updateMainImage(currentIndex);
}
function prevImage() {
  currentIndex =
    (currentIndex - 1 + currentImages.length) % currentImages.length;
  updateMainImage(currentIndex);
}
window.addEventListener("DOMContentLoaded", () => {
  const thumbnailContainer = document.getElementById("thumbnailContainer");
  const mainImage = document.getElementById("mainImage");
  if (!product) {
    document.body.innerHTML =
      '<a href="../index.html" classs"m-auto"><img src="../pic/4044.gif" alt="" class="w-100" style="height: 600px;margin"></a> ';
    return;
  }
  // Use "categoies" since it's what's used in your data — but fix in real data!
  const category = product.categoies;
  if (!category) {
    document.body.innerHTML =
      '    <a href="../index.html"><img src="../pic/nott.gif" alt="" class="w-100 h-auto"></a>';
    return;
  }
  // Get all images from products in the same category
  const sameCategoryItems = dataSmall2.filter(
    (item) => item.categoies === category
  );
  imageList = sameCategoryItems.map((item) => item.img);
  // Remove duplicates
  imageList = [...new Set(imageList)];
  currentImages = imageList;
  currentIndex = currentImages.indexOf(product.img);
  if (currentIndex === -1) currentIndex = 0;

  mainImage.src = currentImages[currentIndex];

  // Create thumbnails
  thumbnailContainer.innerHTML = "";
  currentImages.forEach((imgSrc, index) => {
    const img = document.createElement("img");
    img.src = imgSrc;
    img.alt = `Thumbnail ${index + 1}`;
    img.classList.add("thumbnail");
    if (index === currentIndex) img.classList.add("active");

    img.addEventListener("click", () => selectImage(index));
    thumbnailContainer.appendChild(img);
  });
});

// size

const sizexs = document.querySelector(".size-Xs");
const sizes = document.querySelector(".size-S");
const sizeM = document.querySelector(".size-M");
const sizeL = document.querySelector(".size-L");

sizexs.addEventListener("click", () => {
  sizexs.classList.toggle("sizeSelected");
  sizexs.innerHTML = "XS";
  sizes.classList.remove("sizeSelected");
  sizeM.classList.remove("sizeSelected");
  sizeL.classList.remove("sizeSelected");
});
sizes.addEventListener("click", () => {
  sizes.classList.toggle("sizeSelected");
  sizes.innerHTML = "S";
  sizexs.classList.remove("sizeSelected");
  sizeM.classList.remove("sizeSelected");
  sizeL.classList.remove("sizeSelected");
});
sizeM.addEventListener("click", () => {
  sizeM.innerHTML = "M";
  sizeM.classList.toggle("sizeSelected");
  sizexs.classList.remove("sizeSelected");
  sizes.classList.remove("sizeSelected");
  sizeL.classList.remove("sizeSelected");
});
sizeL.addEventListener("click", () => {
  sizeL.classList.toggle("sizeSelected");
  sizeL.innerHTML = "L";
  sizexs.classList.remove("sizeSelected");
  sizes.classList.remove("sizeSelected");
  sizeM.classList.remove("sizeSelected");
  console.log(sizeL.textContent);
});

const increment = document.querySelector(".increment");
const decrement = document.querySelector(".decrement");
const resultQTY = document.querySelector(".resultQTY");
const btnSub = document.querySelector(".btn-sub");
const result = document.querySelector(".result");
const wrapperitems = document.querySelector(".wrapper-items");
const sizeitem = document.querySelector(".sizeitem");
const qtryitem = document.querySelector(".qtyitem");

resultQTY.innerHTML = 0;
result.innerHTML = 0;
sizeitem.innerHTML = "";
increment.addEventListener("click", function () {
  if (resultQTY.innerHTML >= product.MaxQuantity) {
    alert("Please input Low qty");
    return;
  }
  resultQTY.innerHTML = parseInt(resultQTY.innerHTML) + 1;
});
decrement.addEventListener("click", function () {
  if (resultQTY.innerHTML <= 0) {
    resultQTY.innerHTML = 0;
  } else {
    resultQTY.innerHTML = parseInt(resultQTY.innerHTML) - 1;
  }
});
const nameP = document.querySelector(".nameP");
const udprice = document.querySelector(".usPrice");
const offPrice = document.querySelector(".offPrice");
const usPriceoff = document.querySelector(".usPriceoff");
const typeOfShirt = document.querySelector(".typeOfShirt");
const udpricevart = document.querySelector(".usPricecart");
const offPricecart = document.querySelector(".offPricecart");
const usPriceoffcart = document.querySelector(".usPriceoffcart");
const typeOfShirtcart = document.querySelector(".typeOfShirtcart");
const totalPrice = document.querySelector(".totalPrice");
if (udprice || offPrice || usPriceoff) {
  usPriceoff.textContent = product.usPriceoff;
  udprice.textContent = product.usPrice;
  offPrice.textContent = product.Priceoff;
  typeOfShirt.textContent = product.typeOfShirt;
  nameP.textContent = product.name;
}
// Bag
let totalQuantity = 0; // Keep track of all items added
btnSub.addEventListener("click", function () {
  const quantity = parseInt(resultQTY.innerHTML);
  const selectedSize = document.querySelector(".sizeSelected");
  if (!selectedSize) {
    alert("Please select a size before adding to cart.");
    return;
  }
  if (quantity <= 0) {
    alert("Please choose a quantity greater than 0.");
    return;
  }

  // ✅ Update total result
  totalQuantity += quantity;
  result.innerHTML = totalQuantity;

  // ✅ Get selected image
  const selectedImageSrc = document.getElementById("mainImage").src;

  // ✅ Add to cart
  const cartItem = {
    id: product.id,
    name: product.name,
    size: selectedSize.textContent,
    quantity: quantity,
    image: selectedImageSrc,
    usPriceoff: product.usPriceoff,
    udprice: product.price,
    offPrice: product.Priceoff,
    typeOfShirt: product.typeOfShirt,
    MaxQty: product.MaxQuantity,
  };
  let cart = JSON.parse(localStorage.getItem("cart")) || [];

  // ✅ Check if same size already in cart — if so, update quantity
  const existingItem = cart.find(
    (item) => item.id === product.id && item.size === cartItem.size
  );

  if (existingItem) {
    existingItem.quantity += quantity;
  } else {
    cart.push(cartItem);
  }
  localStorage.setItem("cart", JSON.stringify(cart));

  // ✅ Add UI preview
  const sizeDiv = document.createElement("div");
  sizeDiv.classList.add("ordered-size");
  sizeDiv.setAttribute("data-size", selectedSize.textContent);
  sizeDiv.innerHTML = `Your Ordered: [${selectedSize.textContent}: ${quantity}] 
    <button class="removeSizeBtn btn-size mt-2" data-size="${selectedSize.textContent}"><i class="bi bi-trash3-fill"></i></button>`;
  sizeitem.appendChild(sizeDiv);
  // ✅ Add remove handler
  sizeDiv
    .querySelector(".removeSizeBtn")
    .addEventListener("click", function () {
      const sizeToRemove = this.getAttribute("data-size");
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      cart = cart.filter((item) => item.size !== sizeToRemove);
      localStorage.setItem("cart", JSON.stringify(cart));

      sizeDiv.remove();

      // Recalculate totals
      totalQuantity = 0;
      let totalCost = 0;
      cart.forEach((item) => {
        totalQuantity += item.quantity;
        const price = parseFloat(item.usPriceoff.replace("$", ""));
        totalCost += price * item.quantity;
      });

      result.innerHTML = totalQuantity;
      qtryitem.innerHTML = "Quantity: " + totalQuantity;
      totalPrice.innerHTML = "Total US $" + totalCost.toFixed(2);
      alert(`Removed size ${sizeToRemove} from cart.`);
      const previewImg1 = document.querySelector(".cart-preview-img");
      if (previewImg1 && totalQuantity == 0) {
        previewImg1.src = "";
      }
    });

  // ✅ Update quantity and price
  qtryitem.innerHTML = "Quantity: " + totalQuantity;

  const cleanPrice = parseFloat(product.usPrice.replace("$", ""));
  const itemTotalPrice = cleanPrice * totalQuantity;
  totalPrice.textContent = "Total US $" + itemTotalPrice.toFixed(2);

  // ✅ Show preview
  let previewImg = document.querySelector(".cart-preview-img");
  if (!previewImg) {
    previewImg = document.createElement("img");
    previewImg.classList.add("cart-preview-img");
    document.body.appendChild(previewImg);
  }
  previewImg.src = selectedImageSrc;

  // ✅ Display product details
  if (udpricevart || offPricecart || usPriceoffcart) {
    udpricevart.textContent = product.usPrice;
    offPricecart.textContent = product.Priceoff;
    usPriceoffcart.textContent = product.usPriceoff;
    typeOfShirtcart.textContent = product.typeOfShirt;
  }

  // ✅ Reset input
  resultQTY.innerHTML = 0;
  selectedSize.classList.remove("sizeSelected");

  // ✅ Activate clear button
  const btnclear = document.querySelector(".btn-clear");
  // btnclear.innerHTML = "ClearForm";
  btnclear.classList.add("active");

  btnclear.addEventListener("click", function () {
    localStorage.removeItem("cart");
    totalQuantity = 0;
    result.innerHTML = 0;
    qtryitem.innerHTML = 0;
    sizeitem.innerHTML = "";
    usPriceoffcart.innerHTML = "";
    offPricecart.innerHTML = "";
    udpricevart.innerHTML = "";
    totalPrice.innerHTML = "";
    typeOfShirtcart.textContent = "No Information";

    const previewImg = document.querySelector(".cart-preview-img");
    if (previewImg) {
      previewImg.src = "";
    }
    // Reset size buttons
    document.querySelector(".size-Xs")?.classList.remove("sizeSelected");
    document.querySelector(".size-S")?.classList.remove("sizeSelected");
    document.querySelector(".size-M")?.classList.remove("sizeSelected");
    document.querySelector(".size-L")?.classList.remove("sizeSelected");
    document.querySelector(".size-Xs").textContent = "XS";
    document.querySelector(".size-S").textContent = "S";
    document.querySelector(".size-M").textContent = "M";
    document.querySelector(".size-L").textContent = "L";
    // Clear localStorage for orders
    const orders = JSON.parse(localStorage.getItem("orders")) || [];
    const updatedOrders = orders.filter((order) => order.id !== product.id);
    localStorage.setItem("orders", JSON.stringify(updatedOrders));
    // If on dashboard.html, reload the page to reflect changes
    if (window.location.pathname.includes("dashboard.html")) {
      location.reload();
    }
    alert("Cart has been cleared.");
    btnclear.classList.remove("active");
  });

  alert(
    `Added to cart: ${cartItem.name} [Size: ${cartItem.size}, Qty: ${cartItem.quantity}]\n` +
      `Price per item: ${product.usPrice}\n` +
      `Total for this item: $${itemTotalPrice.toFixed(2)}`
  );
  console.log(quantity);
  console.log(totalQuantity);
  const orders = JSON.parse(localStorage.getItem("orders")) || [];
  const orderItem = {
    ...cartItem,
    date: Date.now(),
  };
  orders.push(orderItem);
  localStorage.setItem("orders", JSON.stringify(orders));
});
// similar
const wrappersimilar = document.querySelector(".wrapper-similar");
const productNot = document.querySelector(".productNot");

if (product.id == id) {
  wrappersimilar.innerHTML = dataSmall2
    .filter((e) => {
      return e.subId == id;
    })
    .map((a) => {
      return ` 
            <div class="col-lg-3 mb-4 col-6">
                <div class="image-card-wrapper w-100 overflow-hidden">
                    <a href="data.html?id=${a.id}">
                        <img src="${a.img}" class="${a.class}" alt="${a.name}">
                    </a>
                </div>
                <div class="wrapper-similar-text mt-3 overflow-hidden">
                    <div class="wrapper-hover">
                    <div class="wrapper-flex-text d-flex justify-content-between align-items-center ">
                        <h5 class="fw-bold text-dark m-0 price-text">US ${a.usPrice}</h5>
        <h5 class=" text-dark fw-bolder clickFav" id="offcanvasRightLabel"><i class="fa-regular fa-heart clickHeart"></i>
        </h5>
    </div>
    <span class="offPriceShow">${a.usPriceoff}</span>
                                    <div class="flex-img d-flex justify-content-between align-items-center"> 
                                    <p class="fw-light pt-1 mb-0">${a.typeOfShirt}</p>
                                    <a href="data.html?id=${a.id}">
                        <img src="${a.img}" class="${a.class} img-price" alt="${a.name}" style="width:35px;height: 35px;">
                    </a>
                </div>
                </div>
                </div>
            </div>
          `;
    })
    .join("");

  console.log(wrappersimilar);
}
if (product.subId !== id) {
  console.log(id, product.subId);
} else {
  productNot.innerHTML =
    ' <article class="productNot"><h2 class="fw-bolder h2No" style="color:red">Product Does Not Exists!</h2>  <img src="../pic/no.webp" alt="" style="width: 150px;"> </article>';
  console.log(product.subId, id);
}

// Add after your existing code

function addToFavorites() {
  const mainImage = document.getElementById("mainImage");
  const selectedSize = document.querySelector(".sizeSelected");

  if (!selectedSize) {
    alert("Please select a size first");
    return;
  }

  const favoriteItem = {
    id: product.id,
    name: product.name,
    img: mainImage.src,
    typeOfShirt: product.typeOfShirt,
    price: product.usPrice,
    priceOff: product.Priceoff,
    usPriceoff: product.usPriceoff,
    size: selectedSize.textContent,
  };

  // Get existing favorites
  let favorites = JSON.parse(localStorage.getItem("favorites")) || [];

  // Check if item already exists
  const existingIndex = favorites.findIndex(
    (item) => item.id === favoriteItem.id && item.size === favoriteItem.size
  );

  if (existingIndex !== -1) {
    // Item exists, remove it
    favorites.splice(existingIndex, 1);
    showToast("Removed from favorites");
    document.querySelector(".btnFav i").classList.remove("fa-solid");
    document.querySelector(".btnFav i").classList.add("fa-regular");
  } else {
    // Add new item
    favorites.push(favoriteItem);
    showToast("Added to favorites");
    document.querySelector(".btnFav i").classList.remove("fa-regular");
    document.querySelector(".btnFav i").classList.add("fa-solid");
  }

  localStorage.setItem("favorites", JSON.stringify(favorites));
}

function showToast(message) {
  const toast = document.createElement("div");
  toast.className = "toast-notification";
  toast.textContent = message;
  document.body.appendChild(toast);

  setTimeout(() => {
    toast.remove();
  }, 2000);
  window.location.href = "./AddFav.html";
}

// Check if item is in favorites on page load
document.addEventListener("DOMContentLoaded", function () {
  const favorites = JSON.parse(localStorage.getItem("favorites")) || [];
  const isInFavorites = favorites.some((item) => item.id === product.id);

  if (isInFavorites) {
    document.querySelector(".btnFav i").classList.remove("fa-regular");
    document.querySelector(".btnFav i").classList.add("fa-solid");
  }
});
// dropdown info
const headers = document.querySelectorAll(".dropdown-header");
headers.forEach((header) => {
  header.addEventListener("click", () => {
    const content = header.querySelector(".wrapper-infoText"); // Get the next .dropdown-content
    const chevron = header.querySelector(".chevron");

    // Toggle active class for content
    content.classList.toggle("active");

    // Toggle icon class
    if (content.classList.contains("active")) {
      chevron.classList.remove("fa-chevron-down");
      chevron.classList.add("fa-chevron-up");
    } else {
      chevron.classList.remove("fa-chevron-up");
      chevron.classList.add("fa-chevron-down");
    }
  });
});

// cart store
document.addEventListener("DOMContentLoaded", function () {
  // Get orders from localStorage
  const orders = JSON.parse(localStorage.getItem("orders")) || [];
  // const ordersTable = document.getElementById("ordersList");
  const totalOrdersSpan = document.querySelectorAll(".totalOrders");
  // const totalAmountSpan = document.getElementById("totalAmount");
  const wrappecanvas = document.querySelector(".wrapper-canvas");
  console.log(orders);

  // Calculate totals
  let totalAmount = 0;

  // Display orders
  orders.forEach((order, index) => {
    // const row = document.createElement("tr");
    const price = parseFloat(order.usPriceoff?.replace("$", "") || 0);
    const total = price * order.quantity;
    totalAmount += total;

    wrappecanvas.innerHTML = `<div class="col-lg-6 col-6">
                        <h5 class="text-dark fw-bold">Ordered Review</h5>
                        <br/>
                        <span class="usPricecart">Price: $${price.toFixed(
                          2
                        )}</span>
                        <h5 class="offPricecart">Discount: ${
                          order.offPrice
                        }</h5>
                        <h5 class="typeOfShirtcart" style="color: black;padding: 0.5rem 0rem;">${
                          order.typeOfShirt
                        }</h5>
                        <h5 class="totalPrice1" id="totalAmount">Total: $${totalAmount.toFixed(
                          2
                        )}</h5>
                        <h5 class="sizeitem1">Size:${order.size}</h5>
                        <h5 class="qtyitem1">Quantity:${order.quantity}</h5>
                        <button class="btn btn-danger btn-sm mt-3" onclick="deleteOrder(${index})">Delete Item
                               <i class="bi bi-trash"></i>
                           </button>
                    </div>
                    <div class="col-lg-6 col-6">
                        <div class="cart-preview">
                            <h5 class="text-dark fw-bold text-right">Cart Preview</h5>
                             <br/>
                            <img class="cart-preview-img w-100" src="${
                              order.image
                            }"/>
                        </div>
                    </div>
                        `;
    if (orders.length == 0) {
      wrappecanvas.innerHTML = "No items";
    }
  });

  // Update totals display
  totalOrdersSpan.forEach((e) => {
    e.textContent = orders.length;
  });
  console.log(orders);
});

function deleteOrder(index) {
  const orders = JSON.parse(localStorage.getItem("orders")) || [];
  orders.splice(index, 1);
  localStorage.setItem("orders", JSON.stringify(orders));
  location.reload();
}
